resource "aws_instance" "master_node" {
  ami           = var.ami_id
  instance_type = var.instance_type
  # other required settings...

  user_data = <<-EOF
              #!/bin/bash

              CONF_FILE="/etc/rsyslog.conf"
              BACKUP_FILE="/etc/rsyslog.conf.bak"
              TARGET_LINE="*.*.*.*@@ulseclogpxy-vip.corp.dmz:514"

              # Create a backup
              cp "$CONF_FILE" "$BACKUP_FILE"

              # Check if the line exists
              if grep -q "^\\*\\.\\*\\.\\*\\.\\*@@ulseclogpxy-vip\\.corp\\.dmz:514" "$CONF_FILE"; then
                  echo "Target line found. Replacing it..."
                  sed -i 's/^\\*\\.\\*\\.\\*\\.\\*@@\\(.*ulseclogpxy-vip\\.corp\\.dmz:514\\)$/\\*\\.\\*@@\\1/' "$CONF_FILE"
                  systemctl restart rsyslog || service rsyslog restart
              else
                  echo "Target line not found. No changes made."
              fi
              EOF

  # tags, security groups, etc.
}
