resource "aws_instance" "master_node" {
  ami           = var.ami_id
  instance_type = var.instance_type
  # other required settings...

  user_data = <<-EOF
              #!/bin/bash

              CONF_FILE="/etc/rsyslog.conf"
              BACKUP_FILE="/etc/rsyslog.conf.bak"
              TARGET_LINE="*.*.*.*@@ulseclogpxy-vip.corp.dmz:514"

              # Create a backup
              cp "$CONF_FILE" "$BACKUP_FILE"

              # Check if the line exists
              if grep -q "^\\*\\.\\*\\.\\*\\.\\*@@ulseclogpxy-vip\\.corp\\.dmz:514" "$CONF_FILE"; then
                  echo "Target line found. Replacing it..."
                  sed -i 's/^\\*\\.\\*\\.\\*\\.\\*@@\\(.*ulseclogpxy-vip\\.corp\\.dmz:514\\)$/\\*\\.\\*@@\\1/' "$CONF_FILE"
                  systemctl restart rsyslog || service rsyslog restart
              else
                  echo "Target line not found. No changes made."
              fi
              EOF

  # tags, security groups, etc.
}


========================


#!/bin/bash

CONF_FILE="/etc/rsyslog.conf"
BACKUP_FILE="/etc/rsyslog.conf.bak"

# Create a backup
cp "$CONF_FILE" "$BACKUP_FILE"

# Check if the specific line exists
if grep -q '^\*\.\*\.\*\.\*@@ulseclogpxy-vip\.corp\.dmz:514' "$CONF_FILE"; then
    echo "Target line found. Replacing it..."
    # Replace the exact pattern with desired output
    sed -i 's|^\*\.\*\.\*\.\*@@ulseclogpxy-vip\.corp\.dmz:514|*.* @@ulseclogpxy-vip.corp.dmz:514|' "$CONF_FILE"
    systemctl restart rsyslog || service rsyslog restart
else
    echo "Target line not found. No changes made."
fi
✅ Terraform user_data Block with This Logic:
Here’s the updated user_data block you can drop into your Terraform EC2 config:

hcl
Copy
Edit
user_data = <<-EOF
            #!/bin/bash

            CONF_FILE="/etc/rsyslog.conf"
            BACKUP_FILE="/etc/rsyslog.conf.bak"

            cp "$CONF_FILE" "$BACKUP_FILE"

            if grep -q '^\\*\\.\\*\\.\\*\\.\\*@@ulseclogpxy-vip\\.corp\\.dmz:514' "$CONF_FILE"; then
                echo "Target line found. Replacing it..."
                sed -i 's|^\\*\\.\\*\\.\\*\\.\\*@@ulseclogpxy-vip\\.corp\\.dmz:514|*.* @@ulseclogpxy-vip.corp.dmz:514|' "$CONF_FILE"
                systemctl restart rsyslog || service rsyslog restart
            else
                echo "Target line not found. No changes made."
            fi
            EOF
🔍 Explanation:
grep -q '^*.*.*.*@@...' → checks if the exact line exists (escaped properly for Terraform).

sed uses | as a delimiter to reduce backslash clutter.

The replacement sets *.* @@... exactly as you asked.
