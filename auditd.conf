---
- name: Ensure auditd logging settings are configured
  hosts: all
  become: true

  tasks:

    - name: Backup auditd.conf before modification
      ansible.builtin.copy:
        src: /etc/audit/auditd.conf
        dest: /etc/audit/auditd.conf.bak
        remote_src: true

    - name: Ensure max_log_file is set to 10
      ansible.builtin.lineinfile:
        path: /etc/audit/auditd.conf
        regexp: '^max_log_file\s*='
        line: 'max_log_file = 10'
        backrefs: false

    - name: Ensure num_logs is set to 20
      ansible.builtin.lineinfile:
        path: /etc/audit/auditd.conf
        regexp: '^num_logs\s*='
        line: 'num_logs = 20'
        backrefs: false

    - name: Ensure max_log_file_action is set to rotate
      ansible.builtin.lineinfile:
        path: /etc/audit/auditd.conf
        regexp: '^max_log_file_action\s*='
        line: 'max_log_file_action = rotate'
        backrefs: false
